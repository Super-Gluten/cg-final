# 拉取和建立远程连接

- **远程连接的核心作用**：
本地仓库仅能满足单人开发需求，建立与远程仓库（如GitHub/GitLab/Gitee）的有效连接是多人协作、代码跨设备同步、版本备份的基础；所有分支推送、拉取、合并等协作操作，均依赖正确的远程仓库配置。
- **远程仓库的配置规范**：
  1. **别名命名**：默认远程仓库别名为`origin`，多仓库场景（如上游主仓库+个人分叉仓库）可区分命名（如`upstream`表示上游主仓库、`origin`表示个人仓库），便于快速识别操作对象；
  2. **协议选择**：优先使用SSH协议（免重复输入账号密码，安全性更高），无SSH密钥配置环境可使用HTTPS协议；
  3. **有效性校验**：定期校验远程连接，避免因仓库地址变更、权限失效导致协作操作失败。

- **拉取远程内容的场景化原则**：
  拉取并非简单执行`git pull`，需根据场景选择对应方式，避免覆盖本地未提交修改或遗漏远程更新：
  - 首次拉取：本地无仓库时，完整克隆远程仓库到本地；
  - 增量拉取：本地已有仓库，仅同步远程新增的提交记录；
  - 仅查不改：只拉取远程分支信息（不合并到本地），用于查看远程最新状态；
  - 指定分支拉取：仅拉取远程某一分支的更新，避免无关分支干扰。

相关操作命令：
```bash
# 一、建立远程连接（核心操作）
# 1. 首次克隆远程仓库到本地（自动建立origin关联）
git clone <远程仓库地址> # 克隆完整仓库，默认拉取默认分支（如main/master）
git clone -b <指定分支名> <远程仓库地址> # 克隆时指定拉取的远程分支

# 2. 本地已有仓库，手动关联远程仓库
git remote add <远程别名> <远程仓库地址> # 示例：git remote add origin git@github.com:xxx/xxx.git
git remote -v # 查看已配置的远程仓库别名和地址（verify，校验配置是否正确）

# 3. 修改已配置的远程仓库地址（如仓库迁移、地址变更）
git remote set-url <远程别名> <新的远程仓库地址> # 示例：git remote set-url origin git@gitlab.com:xxx/xxx.git

# 4. 移除无效的远程仓库关联
git remote remove <远程别名> # 示例：git remote remove upstream

# 二、拉取远程内容（不同场景）
# 1. 仅拉取远程分支信息（不合并到本地），用于查看远程最新状态
git fetch # 拉取所有远程分支的最新提交记录，不修改本地工作区
git fetch <远程别名> <远程分支名> # 仅拉取指定远程分支的信息（示例：git fetch origin feature/pay）

# 2. 增量拉取并合并到本地当前分支（常用，等价于git fetch + git merge）
git pull # 拉取当前分支对应的远程分支并自动合并
git pull <远程别名> <远程分支名>:<本地分支名> # 指定拉取远程分支到本地分支（示例：git pull origin dev:my-dev）

# 3. 拉取远程所有分支的最新信息，并清理本地失效的远程分支关联
git fetch -p # -p（prune）：删除本地已不存在的远程分支关联（如远程已删的分支）

# 三、远程连接校验与问题处理
# 1. 测试远程连接是否有效（SSH协议）
ssh -T git@github.com # GitHub示例，GitLab：ssh -T git@gitlab.com
# 2. HTTPS协议拉取时保存凭证（避免重复输入账号密码）
git config --global credential.helper store # 永久保存，也可设置超时：git config --global credential.helper 'cache --timeout=3600'
```

常见问题处理：

| **问题场景** | **解决命令/方法** |
| --- | --- |
| 拉取时提示“权限被拒绝（publickey）” | 检查SSH密钥是否添加到远程仓库，重新生成/配置SSH密钥：<br>`ssh-keygen -t rsa -C "你的邮箱"` <br>`cat ~/.ssh/id_rsa.pub`（复制公钥到远程仓库） |
| 远程仓库地址错误导致拉取失败 | 用`git remote set-url`修改正确地址，再执行`git fetch`校验 |
| 拉取时提示“本地修改将被合并覆盖” | 先暂存本地修改：`git stash`，拉取完成后恢复：`git stash pop` |
| 多远程仓库混淆，拉取错仓库 | 用`git remote -v`确认别名对应地址，指定别名拉取：`git pull upstream dev` |

# 复制内容
用于将指定文件夹下的所有内容拷贝到目标文件夹，相关操作命令如下：
```bash
# 将0x04文件夹下所有内容，拷贝到0x01中
cp -r 0x04/* 0x01/ # 最基础
cp -ri 0x04/* 0x01/ # 表示覆盖文件前确认是否覆盖
cp -rfv 0x04/* 0x01/ # 强制覆盖并且查看操作过程
```

# 推送与合并
- **本地分支与远程分支一一对应：**
多个本地分支对应一个远程分支，可能导致不同本地分支的提交历史混乱，提升管理难度
- **一定要先拉取+解决合并冲突以后再commit：**
在push前完成该操作，可避免push时的问题，同时能让pull request更顺利的提交给协同人员
- **提交遵循命名规范：**
便于版本检查回溯，规范的commit信息有这些好处：
  1. **快速定位变更**：通过 commit 信息快速理解每个提交的目的。
  2. **简化代码审查**：清晰的描述帮助 reviewer 更快理解修改内容。
  3. **自动生成 Changelog**：规范的提交信息可用于自动生成版本更新日志。
  4. **提升协作效率**：团队成员统一风格，减少沟通成本。

## 完整commit信息规范格式：
```
<类型>(<范围>): <简短描述>
│       │             │
│       │             └─ 对变更的简短描述（不超过50字符）
│       └─────────────── 变更影响的范围（可选）
└──────────────────── 变更的类型
```
示例：
```
fix(login): 修复用户名验证不通过的问题
feat(user): 添加用户头像上传功能
docs(readme): 更新项目安装步骤
```

| **类型** | **描述** | **示例** |
| --- | --- | --- |
| **feat** | 新增功能 | `feat(cart): 添加购物车结算功能` |
| **fix** | 修复 bug | `fix(api): 修复接口404错误` |
| **docs** | 文档更新、添加注释等 | `docs(guide): 更新使用指南` |
| **style** | 代码格式调整（不影响功能） | `style: 统一使用单引号` |
| **refactor** | 代码重构（既不修复 bug 也不新增功能） | `refactor(user): 重构用户模块` |
| **test** | 添加或修改测试 | `test: 补充登录单元测试` |
| **chore** | 构建流程或辅助工具的变更 | `chore: 更新依赖版本` |
| **perf** | 性能优化 | `perf(search): 优化搜索算法` |
| **revert** | 回滚之前的提交 | `revert: 撤销上次错误提交` |
| **sync** | 同步上游commit |  |

- **轻量化提交：**
不要一次性提交体量过大的代码，完成一个任务后就进行一次合理的commit；同时需要合理规划项目结构、代码分层与类的大小，避免将所有内容写在单一代码文件中

相关推送操作命令：
```bash
# 基础的正常推送（不存在其他commit）
cd target_directory # 注意控制好目录的级别
git add . # 将所有修改的文件添加到更改名单中 
git commit -m "描述本次提交"
git push # 通常push到远程的同名分支下

# 推送到远程的指定分支中
git push origin <本地分支名>:<远程分支名> 

# 多人协作下的推送流程（可能有他人commit）
# 在push以前，一定要pull一次解决合并冲突
# 防止覆盖了别人的代码
cd target_directory
git add .
git commit -m "描述本次提交" # 先交到自己的本地分支上

# 关键一步，拉取对应的分支，处理可能的合并冲突
git pull # 非线性处理方式
# git pull origin <分支名>

# git pull --rebase # 线性处理方式

# 解决可能的合并冲突以后
git add <已解决冲突的文件>
git commit -m "合并远程更新，解决冲突"
git push 
```

回退commit命令：
```bash
# 回退到上一个commit，保留工作目录的修改
git reset --soft HEAD~1

# 回退到上一个commit，不保留工作目录的修改（慎用）
git reset --hard HEAD~1
```

# 新建和删除分支
- **分支管理与项目进度的关系：**
项目一般分为开发、测试、发布（生产）几个阶段，可通过以下方式拆分任务、协作开发：
1. **新建临时分支；**
2. **让对应人员在该临时分支内完成需求；**
3. **将临时分支合并以后，再删除该临时分支。**

- **建立有意义的分支命名：**
推荐命名方式：
- `feature/new-module`：新功能开发
- `fix/bug-123`：Bug 修复
- `release/v1.0`：版本发布
- `hotfix/urgent-fix`：紧急修复

相关分支操作命令：
```bash
# 基础的新建一个分支的流程
# 1. 先查看本地分支并做好清理
# 2. 拉取远程分支保证最新
# 3. 根据远程分支或提交历史创建新分支

git branch -a # 查看所有本地分支和远程关联
git branch -d <分支名> # 安全删除本地已合并的分支
git branch -D <分支名> # 强制删除本地分支

git fetch -p # 用于拉取远程分支并删除不再存在的远程关联
git push origin --delete <远程分支名> # 删除对应远程分支（不是关联而是实际删了！）

git checkout -b <分支名> <提交哈希值> # 基于历史提交创建一个新分支
git checkout -b <分支名> origin/<远程分支名> # 基于远程分支创建本地分支

git branch -m <旧分支名> <新分支名>
```

# 阶段性成果
- **文档的编写和轻量化commit：**
当编写了一定体量的代码后，需要及时编写文档，对工作与贡献做阶段性总结，编辑为合理的对应文档，便于同事理解、改进与测试。